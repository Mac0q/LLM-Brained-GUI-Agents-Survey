<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GUI Research Papers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        th.sortable:hover {
            cursor: pointer;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container my-4">
        <h1 class="text-center mb-4">GUI Research Papers</h1>
        <!-- Filters -->
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="taxonomy-select" class="form-label">Taxonomy of GUI Research Papers:</label>
                <select id="taxonomy-select" class="form-select">
                    <option value="">All Categories</option>
                    <option value="survey">Survey</option>
                    <option value="benchmark">Benchmark</option>
                    <option value="dataset">Dataset</option>
                    <option value="framework">Framework</option>
                    <option value="gui-test">Application: GUI Test</option>
                    <option value="virtual assistant">Application: Virtual Assistant</option>
                    <option value="models">Models</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="filter-platform" class="form-label">Filter by Platform:</label>
                <select id="filter-platform" class="form-select">
                    <option value="">All Platforms</option>
                    <option value="mobile">Mobile</option>
                    <option value="web">Web</option>
                    <option value="computer">Computer</option>
                    <option value="cross platform">Cross Platform</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="filter-keyword" class="form-label">Filter by Keyword (Highlight):</label>
                <input type="text" id="filter-keyword" class="form-control" placeholder="Filter by Keyword">
            </div>
            <div class="col-md-3">
                <button id="reset-filters" class="btn btn-secondary w-100 mt-4">Reset Filters</button>
            </div>
        </div>
        <!-- Papers Table -->
        <table class="table table-bordered table-striped">
            <thead id="table-header">
                <!-- Dynamic Table Headers -->
            </thead>
            <tbody id="table-body">
                <!-- Data Rows (will be dynamically generated) -->
            </tbody>
        </table>
    </div>
    <script>
        let data = [];

        const jsonFiles = [
            { file: 'survey.json', category: 'survey' },
            { file: 'benchmark.json', category: 'benchmark' },
            { file: 'dataset.json', category: 'dataset' },
            { file: 'framework.json', category: 'framework' },
            { file: 'gui-test.json', category: 'gui-test' },
            { file: 'virtual-assistant.json', category: 'virtual assistant' },
            { file: 'models.json', category: 'models' }
        ];

        let currentSort = { column: "Date", ascending: true };
        let taxonomyFilter = "";
        let keywordFilter = "";

        async function loadData() {
            try {
                const dataPromises = jsonFiles.map(async (jsonFile) => {
                    const responseData = await fetchData(jsonFile.file);
                    responseData.forEach(item => item.Category = jsonFile.category);
                    return responseData;
                });

                const allData = await Promise.all(dataPromises);
                data = allData.flat();
                filterData();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        async function fetchData(fileName) {
            const response = await fetch(fileName);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status} while fetching ${fileName}`);
            }
            return await response.json();
        }

        function mapPlatform(platform) {
            if (!platform) return [];

            const lowerPlatform = platform.toLowerCase();

            let isWeb = false;
            let isMobile = false;
            let isComputer = false;

            if (lowerPlatform.includes("web") || lowerPlatform.includes("browser")) isWeb = true;
            if (lowerPlatform.includes("mobile") || lowerPlatform.includes("android") || lowerPlatform.includes("ios") || lowerPlatform.includes("apple")) isMobile = true;
            if (lowerPlatform.includes("pc") || lowerPlatform.includes("linux") || lowerPlatform.includes("windows") || lowerPlatform.includes("mac") || lowerPlatform.includes("desktop") || lowerPlatform.includes("computer")) isComputer = true;

            const result = new Set();
            if ((isWeb && isMobile && isComputer) || (isMobile && isComputer) || (isWeb && isComputer)|| (isWeb && isMobile)) result.add("cross platform");
            if (isWeb) result.add("web");
            if (isMobile) result.add("mobile");
            if (isComputer) result.add("computer");

            return Array.from(result);
        }

        function updateTable(filteredData) {
            const headerRow = ["Name", "Platform", "Date", "Paper_Url", "Highlight", "Code_Url", "Category"]
                .map(header => {
                    const arrow = currentSort.column === header
                        ? (currentSort.ascending ? " ▲" : " ▼")
                        : "";
                    return `<th class="sortable" data-column="${header}">${header.replace("_Url", " Link")}${arrow}</th>`;
                }).join("");
            document.getElementById("table-header").innerHTML = `<tr>${headerRow}</tr>`;

            const rows = filteredData.map(row => {
                return `<tr>
                    ${["Name", "Platform", "Date", "Paper_Url", "Highlight", "Code_Url", "Category"]
                        .map(header => {
                            if (header.includes("_Url")) {
                                const url = row[header];
                                if (!url || url === "/") return `<td>N/A</td>`;
                                const linkText = header.startsWith("Paper") ? "Paper Link" : "Code Link";
                                return `<td><a href="${url}" target="_blank">${linkText}</a></td>`;
                            }
                            if (header === "Highlight" && keywordFilter) {
                                const regex = new RegExp(`(${keywordFilter})`, "gi");
                                const highlightedText = row[header] ? row[header].replace(regex, "<mark>$1</mark>") : "N/A";
                                return `<td>${highlightedText}</td>`;
                            }
                            return `<td>${row[header] || "N/A"}</td>`;
                        }).join("")}
                </tr>`;
            }).join("");

            document.getElementById("table-body").innerHTML = rows;
        }

        function sortData(dataArray, column, ascending) {
            return dataArray.sort((a, b) => {
                if (!a[column] || !b[column]) return 0;
                if (column === "Date") {
                    return ascending ? new Date(a[column]) - new Date(b[column]) : new Date(b[column]) - new Date(a[column]);
                }
                const valueA = a[column].toString().toLowerCase();
                const valueB = b[column].toString().toLowerCase();
                return ascending ? valueA.localeCompare(valueB) : valueB.localeCompare(valueA);
            });
        }

        function filterData() {
            const platformFilter = document.getElementById("filter-platform").value.toLowerCase();
            keywordFilter = document.getElementById("filter-keyword").value.toLowerCase();

            const filtered = data.filter(row => {
                const categoryMatch = !taxonomyFilter || row.Category === taxonomyFilter;
                const mappedPlatform = mapPlatform(row.Platform);
                const platformMatch = !platformFilter || mappedPlatform.includes(platformFilter);
                const highlightText = row.Highlight ? row.Highlight.toLowerCase() : "";
                const keywordMatch = !keywordFilter || highlightText.includes(keywordFilter);

                return categoryMatch && platformMatch && keywordMatch;
            });

            const sortedData = sortData(filtered, currentSort.column, currentSort.ascending);
            updateTable(sortedData);
        }

        document.getElementById("taxonomy-select").addEventListener("change", event => {
            taxonomyFilter = event.target.value;
            filterData();
        });
        document.getElementById("filter-platform").addEventListener("change", filterData);
        document.getElementById("filter-keyword").addEventListener("input", filterData);
        document.getElementById("reset-filters").addEventListener("click", () => {
            document.getElementById("taxonomy-select").value = "";
            document.getElementById("filter-platform").value = "";
            document.getElementById("filter-keyword").value = "";
            taxonomyFilter = "";
            keywordFilter = "";
            filterData();
        });
        document.getElementById("table-header").addEventListener("click", event => {
            if (event.target.classList.contains("sortable")) {
                const column = event.target.dataset.column;
                currentSort.ascending = currentSort.column === column ? !currentSort.ascending : true;
                currentSort.column = column;
                filterData();
            }
        });

        loadData();
    </script>
</body>
</html>
